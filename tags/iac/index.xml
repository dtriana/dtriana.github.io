<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>IaC on David Triana</title><link>https://davidtriana.com/tags/iac/</link><description>Recent content in IaC on David Triana</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><managingEditor>david@davidtriana.com (David Triana)</managingEditor><webMaster>david@davidtriana.com (David Triana)</webMaster><copyright>2022 David Triana All rights reserved</copyright><lastBuildDate>Tue, 15 Oct 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://davidtriana.com/tags/iac/index.xml" rel="self" type="application/rss+xml"/><item><title>Deploying Logic Apps Standard Without App Settings Secrets</title><link>https://davidtriana.com/posts/2024/logic-app-no-secrets/</link><pubDate>Tue, 15 Oct 2024 00:00:00 +0000</pubDate><author>david@davidtriana.com (David Triana)</author><guid>https://davidtriana.com/posts/2024/logic-app-no-secrets/</guid><description>&lt;h1 id="scenario">
Scenario
&lt;a class="heading-link" href="#scenario">
&lt;i class="fa fa-link" aria-hidden="true" title="Link to heading">&lt;/i>
&lt;span class="sr-only">Link to heading&lt;/span>
&lt;/a>
&lt;/h1>
&lt;p>Logic Apps Standard use Application Settings. By default these settings have secrets, particularly the key in the connection string for the storage account used to keep the code and the state and run history of all the workflows. In addition, if using Application Insights integration, there is the instrumentation key which according to some &lt;a href="https://learn.microsoft.com/en-us/azure/azure-monitor/app/connection-strings#is-the-connection-string-a-secret">including the official documentation&lt;/a> is not really a secret, still, something I don&amp;rsquo;t like there in plain text in the settings.&lt;/p>
&lt;p>This is how it looks like after creating one using the portal, mid Oct 2024, in the East US region:&lt;/p>
&lt;p>&lt;img src="https://davidtriana.com/images/posts/2024/no-secrets-default.png" alt="Default App Settings Deployed from the Portal">&lt;/p>
&lt;h2 id="solution">
Solution
&lt;a class="heading-link" href="#solution">
&lt;i class="fa fa-link" aria-hidden="true" title="Link to heading">&lt;/i>
&lt;span class="sr-only">Link to heading&lt;/span>
&lt;/a>
&lt;/h2>
&lt;p>With the &lt;a href="https://learn.microsoft.com/en-us/azure/logic-apps/create-single-tenant-workflows-azure-portal#set-up-managed-identity-access-to-your-storage-account">recent announcement of support for managed identities in Logic Apps&lt;/a>, combined with the existing support for &lt;a href="https://learn.microsoft.com/en-us/azure/app-service/app-service-key-vault-references?tabs=azure-cli">Function Apps&lt;/a> and &lt;a href="https://learn.microsoft.com/en-us/azure/azure-monitor/app/azure-ad-authentication?tabs=nodejs#configure-and-enable-microsoft-entra-id-based-authentication">Application Insights&lt;/a>, I came up with a Bicep template which deploys the full underlying infrastructure without any secrets in App Settings:&lt;/p>
&lt;p>&lt;img src="https://davidtriana.com/images/posts/2024/no-secrets-without-secrets.png" alt="App Settings Without Secrets">&lt;/p>
&lt;p>Here the storage account connection string used in the WEBSITE_CONTENTAZUREFILECONNECTIONSTRING setting is now a KeyVault reference, which is populated and refreshed by the platform using RBAC and a user managed identity assigned to the Logic App.&lt;/p>
&lt;p>The earlier AzureWebjobsStorage setting, which also had the same connection string is no longer there, replaced by settings which rely on managed identities and RBAC to gain access to the storage account.&lt;/p>
&lt;p>Finally, the instrumentation key for App Insights is now a reference to a KeyVault secret.&lt;/p>
&lt;h2 id="challenges">
Challenges
&lt;a class="heading-link" href="#challenges">
&lt;i class="fa fa-link" aria-hidden="true" title="Link to heading">&lt;/i>
&lt;span class="sr-only">Link to heading&lt;/span>
&lt;/a>
&lt;/h2>
&lt;h3 id="rbac-propagation">
RBAC Propagation
&lt;a class="heading-link" href="#rbac-propagation">
&lt;i class="fa fa-link" aria-hidden="true" title="Link to heading">&lt;/i>
&lt;span class="sr-only">Link to heading&lt;/span>
&lt;/a>
&lt;/h3>
&lt;p>The first challenge is with RBAC propagation. Logic Apps need access to the storage account. This is verified during deployment, failing the deployment if, for instance, the permission in KeyVault for the Logic App to access the secret which contains the connection string is not there yet. I tried using dependsOn, outputs, modules, and while it worked every once in a while it was not consistent, every 2/3 times I was getting the error:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-text" data-lang="text">Unable to resolve Azure Files Settings from Key Vault. Details: Unable to resolve setting: WEBSITE_CONTENTAZUREFILECONNECTIONSTRING with error: AccessToKeyVaultDenied.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Even directly in the Azure Portal, assigning the role to myself I had to refresh the page and wait for up to a minute to be able to query the secrets in KeyVault.&lt;/p>
&lt;p>There is an &lt;a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-app-settings#website_skip_contentshare_validation">application setting&lt;/a> that allows the deployment to succeed by disabling the validation, but with this the file share is not created automatically, I tried creating it manually but failed to make it work.&lt;/p>
&lt;p>Adding a two minutes wait via deployment scripts gave me a consistent experience. I have deployed this Bicep at least 4 times in new resource groups in different regions with consistent success.&lt;/p>
&lt;h3 id="azure-roles">
Azure Roles
&lt;a class="heading-link" href="#azure-roles">
&lt;i class="fa fa-link" aria-hidden="true" title="Link to heading">&lt;/i>
&lt;span class="sr-only">Link to heading&lt;/span>
&lt;/a>
&lt;/h3>
&lt;p>This Bicep works fine as long as the identity used to run the deployment has the proper roles. I&amp;rsquo;m testing against an Azure subscription for which I&amp;rsquo;m the owner, however in a realistic scenario I won&amp;rsquo;t have that privilege. In a realistic corporate scenario the script will be run by Azure DevOps or GitHub actions. For those deployment pipelines to succeed, their identities need to be able to &lt;a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-steps#step-4-check-your-prerequisites">assign roles&lt;/a> and &lt;a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/deployment-script-bicep?tabs=CLI#configure-the-minimum-permissions">run scripts&lt;/a> in addition to the permissions to deploy the resources.&lt;/p>
&lt;h3 id="system-assigned-vs-user-assigned">
System assigned vs user assigned
&lt;a class="heading-link" href="#system-assigned-vs-user-assigned">
&lt;i class="fa fa-link" aria-hidden="true" title="Link to heading">&lt;/i>
&lt;span class="sr-only">Link to heading&lt;/span>
&lt;/a>
&lt;/h3>
&lt;p>I prefer system assigned identities over user assigned. Simpler to setup, simpler to use and permissions deleted automatically when the parent resource is deleted. The problem here with system assigned is that the identity won&amp;rsquo;t be available until after the logic is deployed, but I need the identity in advance, to assign the RBAC in KeyVault. User assigned identities makes this feasible since the managed identity can be created independently of the resources which are going to use it.&lt;/p>
&lt;h2 id="the-bicep-templates">
The Bicep Templates
&lt;a class="heading-link" href="#the-bicep-templates">
&lt;i class="fa fa-link" aria-hidden="true" title="Link to heading">&lt;/i>
&lt;span class="sr-only">Link to heading&lt;/span>
&lt;/a>
&lt;/h2>
&lt;h3 id="secretsbicep">
secrets.bicep
&lt;a class="heading-link" href="#secretsbicep">
&lt;i class="fa fa-link" aria-hidden="true" title="Link to heading">&lt;/i>
&lt;span class="sr-only">Link to heading&lt;/span>
&lt;/a>
&lt;/h3>
&lt;p>Since I struggled so much with RBAC propagation I ended up leaving this portion of the script on its own module, and a more maintainable and reusable solution will have more modules than this one.&lt;/p>
&lt;p>The secrets module takes care of creating the secrets in KeyVault, in particular the storage account connection string and the Application Insights instrumentation Key. After that it gives RBAC permissions to the managed identity to read those secrets, then waits for 2 minutes.&lt;/p>
&lt;p>The RBAC permissions are set at the individual secret level. While this enforces the minimal privilege principle, alternatively the permission can be set at the KeyVault level, allowing access to all the secrets, which will be much more convenient specially since in addition to these secrets there might be others used by the workflows.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-fallback" data-lang="fallback">param projectName string
param environmentName string
param locationName string
param storageAccountName string
param keyVaultName string
// Azure Built-in roles Ref: https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles
var keyVaultSecretsUserRoleDefinitionId = &amp;#39;4633458b-17de-408a-b874-0445c86b69e6&amp;#39;
resource keyVault &amp;#39;Microsoft.KeyVault/vaults@2023-07-01&amp;#39; existing = {
name: keyVaultName
}
resource storageAccount &amp;#39;Microsoft.Storage/storageAccounts@2022-05-01&amp;#39; existing = {
name: storageAccountName
}
resource appInsights &amp;#39;microsoft.insights/components@2020-02-02-preview&amp;#39; existing = {
name: &amp;#39;appi-${projectName}-${environmentName}-${locationName}&amp;#39;
}
resource managedIdentity &amp;#39;Microsoft.ManagedIdentity/userAssignedIdentities@2022-01-31-preview&amp;#39; existing = {
name: &amp;#39;mi-${projectName}-${environmentName}-${locationName}&amp;#39;
}
@description(&amp;#39;Adds the storage account connection string as a secret in KeyVault&amp;#39;)
resource storageAccountConnStringSecret &amp;#39;Microsoft.KeyVault/vaults/secrets@2023-07-01&amp;#39; = {
name: &amp;#39;${storageAccount.name}-connectionString&amp;#39;
parent: keyVault
tags: {
ResourceType: &amp;#39;StorageAccount&amp;#39;
ResourceName: storageAccount.name
}
properties: {
contentType: &amp;#39;string&amp;#39;
value: &amp;#39;DefaultEndpointsProtocol=https;AccountName=${storageAccountName};AccountKey=${listKeys(storageAccount.id,&amp;#39;2019-06-01&amp;#39;).keys[0].value};EndpointSuffix=core.windows.net&amp;#39;
}
}
@description(&amp;#39;Gives permissions to the Managed Identity to retrieve the connection string from KeyVault&amp;#39;)
resource logicAppKeyVaultConnectionStringPermission &amp;#39;Microsoft.Authorization/roleAssignments@2022-04-01&amp;#39; = {
name: guid(keyVaultSecretsUserRoleDefinitionId, keyVault.id, managedIdentity.id, storageAccount.id)
scope: storageAccountConnStringSecret
properties: {
roleDefinitionId: subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, keyVaultSecretsUserRoleDefinitionId)
principalId: managedIdentity.properties.principalId
}
}
@description(&amp;#39;Adds the App Insights Instrumentation Key as a secret in KeyVault&amp;#39;)
resource appInsightsSecret &amp;#39;Microsoft.KeyVault/vaults/secrets@2023-07-01&amp;#39; = {
name: &amp;#39;${appInsights.name}-instrumentationKey&amp;#39;
parent: keyVault
tags: {
ResourceType: &amp;#39;AppInsights&amp;#39;
ResourceName: appInsights.name
}
properties: {
contentType: &amp;#39;string&amp;#39;
value: appInsights.properties.InstrumentationKey
}
}
@description(&amp;#39;Gives permissions to the Managed Identity to retrieve the AppInsights Instrumentation Key from KeyVault&amp;#39;)
resource logicAppKeyVaultInstrumentationKeyPermission &amp;#39;Microsoft.Authorization/roleAssignments@2022-04-01&amp;#39; = {
name: guid(keyVaultSecretsUserRoleDefinitionId, keyVault.id, managedIdentity.id, appInsights.id)
scope: appInsightsSecret
properties: {
roleDefinitionId: subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, keyVaultSecretsUserRoleDefinitionId)
principalId: managedIdentity.properties.principalId
}
}
@description(&amp;#39;Wait for 2 minutes to allow RBAC propagation to complete&amp;#39;)
resource deploymentScript &amp;#39;Microsoft.Resources/deploymentScripts@2023-08-01&amp;#39; = {
name: &amp;#39;inlineCLI&amp;#39;
location: locationName
kind: &amp;#39;AzurePowerShell&amp;#39;
properties: {
azPowerShellVersion: &amp;#39;12.2&amp;#39;
scriptContent: &amp;#39;Start-Sleep -Seconds 120&amp;#39;
retentionInterval: &amp;#39;PT1H&amp;#39;
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="infrastructurebicep">
infrastructure.bicep
&lt;a class="heading-link" href="#infrastructurebicep">
&lt;i class="fa fa-link" aria-hidden="true" title="Link to heading">&lt;/i>
&lt;span class="sr-only">Link to heading&lt;/span>
&lt;/a>
&lt;/h2>
&lt;p>This is the main script, which deploys all resources, configures application settings and setups RBAC roles for the storage account&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-fallback" data-lang="fallback">param subscriptionId string = subscription().id
param projectName string = &amp;#39;atlantis&amp;#39;
param environmentName string = &amp;#39;dev&amp;#39;
param locationName string = resourceGroup().location
param storageAccountName string = &amp;#39;st${projectName}${environmentName}${locationName}&amp;#39;
param hostingPlanName string = &amp;#39;app-${projectName}-${environmentName}-${locationName}&amp;#39;
param logicAppName string = &amp;#39;logic-${projectName}-${environmentName}-${locationName}&amp;#39;
param keyVaultName string = &amp;#39;kv-${projectName}-${environmentName}-${locationName}&amp;#39;
var isProduction = environmentName == &amp;#39;prod&amp;#39;
// Azure Built-in roles Ref: https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles
var storageAccountContributorRoleDefinitionId = &amp;#39;17d1049b-9a84-46fb-8f53-869881c3d3ab&amp;#39;
var storageBlobDataOwnerRoleDefinitionId = &amp;#39;b7e6dc6d-f1e8-4753-8033-0f276bb0955b&amp;#39;
var storageTableDataContributorRoleDefinitionId = &amp;#39;0a9a7e1f-b9d0-4cc4-a60d-0319b160aaa3&amp;#39;
var storageQueueDataContributorRoleDefinitionId = &amp;#39;974c5e8b-45b9-4653-ba55-5f855dd0fb88&amp;#39;
var monitoringMetricsPublisherRoleDefinitionId = &amp;#39;3913510d-42f4-4e42-8a64-420c390055eb&amp;#39;
resource managedIdentity &amp;#39;Microsoft.ManagedIdentity/userAssignedIdentities@2022-01-31-preview&amp;#39; = {
name: &amp;#39;mi-${projectName}-${environmentName}-${locationName}&amp;#39;
location: locationName
}
resource keyVault &amp;#39;Microsoft.KeyVault/vaults@2023-07-01&amp;#39; = {
name: keyVaultName
location: locationName
properties: {
sku: {
name: &amp;#39;standard&amp;#39;
family: &amp;#39;A&amp;#39;
}
tenantId: subscription().tenantId
enableSoftDelete: isProduction
enableRbacAuthorization: true
}
}
resource storageAccount &amp;#39;Microsoft.Storage/storageAccounts@2022-05-01&amp;#39; = {
name: storageAccountName
location: locationName
tags: {}
sku: {
name: &amp;#39;Standard_LRS&amp;#39;
}
properties: {
supportsHttpsTrafficOnly: true
minimumTlsVersion: &amp;#39;TLS1_2&amp;#39;
defaultToOAuthAuthentication: true
}
kind: &amp;#39;StorageV2&amp;#39;
}
module secrets &amp;#39;secrets.bicep&amp;#39; = {
name: &amp;#39;secrets-${environmentName}&amp;#39;
params: {
projectName: projectName
environmentName: environmentName
locationName: locationName
storageAccountName: storageAccountName
keyVaultName: keyVaultName
}
dependsOn: [
managedIdentity
keyVault
storageAccount
appInsights
]
}
resource hostingPlan &amp;#39;Microsoft.Web/serverfarms@2022-09-01&amp;#39; = {
name: hostingPlanName
location: locationName
kind: &amp;#39;windows&amp;#39;
sku: {
name: &amp;#39;WS1&amp;#39;
tier: &amp;#39;WorkflowStandard&amp;#39;
}
}
resource logicApp &amp;#39;Microsoft.Web/sites@2022-09-01&amp;#39; = {
name: logicAppName
kind: &amp;#39;functionapp,workflowapp&amp;#39;
location: locationName
tags: {
&amp;#39;hidden-link: /app-insights-resource-id&amp;#39;: &amp;#39;/subscriptions/${subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${logicAppName}&amp;#39;
}
properties: {
publicNetworkAccess: &amp;#39;Enabled&amp;#39;
httpsOnly: true
serverFarmId: hostingPlan.id
keyVaultReferenceIdentity: managedIdentity.id
}
identity: {
type: &amp;#39;UserAssigned&amp;#39;
userAssignedIdentities: {
&amp;#39;${managedIdentity.id}&amp;#39;: {}
}
}
}
resource logAnalyticsWS &amp;#39;Microsoft.OperationalInsights/workspaces@2023-09-01&amp;#39; = {
name: &amp;#39;log-${projectName}-${environmentName}-${locationName}&amp;#39;
location: locationName
}
resource appInsights &amp;#39;microsoft.insights/components@2020-02-02-preview&amp;#39; = {
name: &amp;#39;appi-${projectName}-${environmentName}-${locationName}&amp;#39;
location: locationName
kind: &amp;#39;web&amp;#39;
properties: {
Request_Source: &amp;#39;IbizaWebAppExtensionCreate&amp;#39;
Flow_Type: &amp;#39;Redfield&amp;#39;
Application_Type: &amp;#39;web&amp;#39;
DisableLocalAuth: true
WorkspaceResourceId: logAnalyticsWS.id
}
}
resource logicAppStorageAccountPermission &amp;#39;Microsoft.Authorization/roleAssignments@2022-04-01&amp;#39; = {
name: guid(storageAccountContributorRoleDefinitionId, keyVault.id, storageAccount.id, managedIdentity.id)
scope: storageAccount
properties: {
roleDefinitionId: subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, storageAccountContributorRoleDefinitionId)
principalId: managedIdentity.properties.principalId
}
}
resource logicAppStorageBlobPermission &amp;#39;Microsoft.Authorization/roleAssignments@2022-04-01&amp;#39; = {
name: guid(storageBlobDataOwnerRoleDefinitionId, keyVault.id, storageAccount.id, managedIdentity.id)
scope: storageAccount
properties: {
roleDefinitionId: subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, storageBlobDataOwnerRoleDefinitionId)
principalId: managedIdentity.properties.principalId
}
}
resource logicAppStorageTablesPermission &amp;#39;Microsoft.Authorization/roleAssignments@2022-04-01&amp;#39; = {
name: guid(storageTableDataContributorRoleDefinitionId, keyVault.id, storageAccount.id, managedIdentity.id)
scope: storageAccount
properties: {
roleDefinitionId: subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, storageTableDataContributorRoleDefinitionId)
principalId: managedIdentity.properties.principalId
}
}
resource logicAppQueuePermission &amp;#39;Microsoft.Authorization/roleAssignments@2022-04-01&amp;#39; = {
name: guid(storageQueueDataContributorRoleDefinitionId, keyVault.id, storageAccount.id, managedIdentity.id)
scope: storageAccount
properties: {
roleDefinitionId: subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, storageQueueDataContributorRoleDefinitionId)
principalId: managedIdentity.properties.principalId
}
}
resource logicAppMonitoringPermission &amp;#39;Microsoft.Authorization/roleAssignments@2022-04-01&amp;#39; = {
name: guid(monitoringMetricsPublisherRoleDefinitionId, keyVault.id, appInsights.id, managedIdentity.id)
scope: appInsights
properties: {
roleDefinitionId: subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, monitoringMetricsPublisherRoleDefinitionId)
principalId: managedIdentity.properties.principalId
}
}
resource siteconfig &amp;#39;Microsoft.Web/sites/config@2022-09-01&amp;#39; = {
parent: logicApp
name: &amp;#39;web&amp;#39;
kind: &amp;#39;string&amp;#39;
properties: {
appSettings: [
{
name: &amp;#39;FUNCTIONS_EXTENSION_VERSION&amp;#39;
value: &amp;#39;~4&amp;#39;
}
{
name: &amp;#39;FUNCTIONS_WORKER_RUNTIME&amp;#39;
value: &amp;#39;node&amp;#39;
}
{
name: &amp;#39;WEBSITE_NODE_DEFAULT_VERSION&amp;#39;
value: &amp;#39;~20&amp;#39;
}
{
name: &amp;#39;APPINSIGHTS_INSTRUMENTATIONKEY&amp;#39;
value: &amp;#39;@Microsoft.KeyVault(VaultName=${keyVaultName};SecretName=${appInsights.name}-instrumentationKey)&amp;#39;
}
{
name: &amp;#39;APPLICATIONINSIGHTS_AUTHENTICATION_STRING&amp;#39;
value: &amp;#39;Authorization=AAD;ClientId=${managedIdentity.properties.clientId}&amp;#39;
}
{
name: &amp;#39;WEBSITE_CONTENTAZUREFILECONNECTIONSTRING&amp;#39;
value: &amp;#39;@Microsoft.KeyVault(VaultName=${keyVaultName};SecretName=${storageAccount.name}-connectionString)&amp;#39;
}
{
name: &amp;#39;WEBSITE_CONTENTSHARE&amp;#39;
value: &amp;#39;${toLower(storageAccountName)}-contentshare&amp;#39;
}
{
name: &amp;#39;AzureFunctionsJobHost__extensionBundle__id&amp;#39;
value: &amp;#39;Microsoft.Azure.Functions.ExtensionBundle.Workflows&amp;#39;
}
{
name: &amp;#39;AzureFunctionsJobHost__extensionBundle__version&amp;#39;
value: &amp;#39;[1.*, 2.0.0)&amp;#39;
}
{
name: &amp;#39;APP_KIND&amp;#39;
value: &amp;#39;workflowApp&amp;#39;
}
{
name:&amp;#39;AzureWebJobsStorage__blobServiceUri&amp;#39;
value: storageAccount.properties.primaryEndpoints.blob
}
{
name:&amp;#39;AzureWebJobsStorage__queueServiceUri&amp;#39;
value: storageAccount.properties.primaryEndpoints.queue
}
{
name:&amp;#39;AzureWebJobsStorage__tableServiceUri&amp;#39;
value: storageAccount.properties.primaryEndpoints.table
}
{
name:&amp;#39;AzureWebJobsStorage__credential&amp;#39;
value: &amp;#39;managedIdentity&amp;#39;
}
{
name:&amp;#39;AzureWebJobsStorage__managedIdentityResourceId&amp;#39;
value: managedIdentity.id
}
]
}
dependsOn: [
secrets
]
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="outcome">
Outcome
&lt;a class="heading-link" href="#outcome">
&lt;i class="fa fa-link" aria-hidden="true" title="Link to heading">&lt;/i>
&lt;span class="sr-only">Link to heading&lt;/span>
&lt;/a>
&lt;/h2>
&lt;p>The script runs without errors or warnings, and the infrastructure is now available.&lt;/p>
&lt;p>&lt;img src="https://davidtriana.com/images/posts/2024/no-secrets-deployed.png" alt="Infrastructure deployed">&lt;/p>
&lt;h2 id="workflow-test">
Workflow Test
&lt;a class="heading-link" href="#workflow-test">
&lt;i class="fa fa-link" aria-hidden="true" title="Link to heading">&lt;/i>
&lt;span class="sr-only">Link to heading&lt;/span>
&lt;/a>
&lt;/h2>
&lt;p>While the fact that the deployment worked and the logic app is able to show the runtime version without error notifications is a good sign, nothing like a simple test, so I created the simplest workflow then verified run history with per action state.&lt;/p>
&lt;p>&lt;img src="https://davidtriana.com/images/posts/2024/no-secrets-workflow-test.png" alt="Simple workflow state and history">&lt;/p>
&lt;h2 id="application-insights">
Application Insights
&lt;a class="heading-link" href="#application-insights">
&lt;i class="fa fa-link" aria-hidden="true" title="Link to heading">&lt;/i>
&lt;span class="sr-only">Link to heading&lt;/span>
&lt;/a>
&lt;/h2>
&lt;p>Telemetry is being captured by Application Insights.&lt;/p>
&lt;p>&lt;img src="https://davidtriana.com/images/posts/2024/no-secrets-appinsights-test.png" alt="Telemetry in app insights">&lt;/p></description></item></channel></rss>